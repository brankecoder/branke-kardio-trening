<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kardio Trening v3.20</title>

<style>

body{
margin:0;
font-family:Arial, sans-serif;
background:#111;
color:white;
text-align:center;
}

h1{
margin-top:0;
margin-bottom:0;
}

.version{
font-size:14px;
color:red;
margin-left:8px;
position:relative;
display:inline-block;
}

.version a{
position:absolute;
left:0;
top:0;
width:100%;
height:100%;
text-decoration:none;
color:transparent;
background:transparent;
}

.author{
font-size:12px;
color:red;
margin-bottom:15px;
}

.container{
display:flex;
flex-direction:column;
align-items:center;
padding-top:10px;
}

button{
padding:10px 18px;
margin:3px;
font-size:16px;
border-radius:4px;
border:none;
cursor:pointer;
}

.etape-buttons button{
background:#444;
color:white;
width:60px;
}

.main-btn{
background:#2ecc71;
color:black;
font-weight:bold;
}

.stop-btn{
background:#e74c3c;
color:white;
font-weight:bold;
}

.green-btn{
background:#2ecc71;
color:black;
font-weight:bold;
}

.red-btn{
background:#e74c3c;
color:white;
font-weight:bold;
}

.white-btn{
background:white;
color:black;
font-weight:bold;
}

.hidden{
display:none;
}

.phase-label{
font-size:24px;
font-weight:bold;
margin:10px 0 18px 0;
}

.total-time{
margin-top:0;
margin-bottom:18px;
font-size:21.6px;
}

.remaining-time{
margin-top:18px;
margin-bottom:18px;
font-size:21.6px;
}

.circles{
display:flex;
gap:15px;
margin:0 0 5px 0;
justify-content:center;
}

.circle{
width:90px;
height:90px;
border-radius:50%;
position:relative;
overflow:hidden;
}

.exercise{
background:#2ecc71;
}

.rest{
background:#e74c3c;
}

.cooldown{
background:#3498db;
}

.fill{
position:absolute;
bottom:0;
width:100%;
height:0%;
background:rgba(0,0,0,0.35);
transition:height 1s linear;
}

.info{
font-size:21.6px;
margin:18px 10px 10px 10px;
}

.donation{
margin-top:30px;
font-size:14px;
}

.donation a,
.upute a,
.whatsapp-link a{
color:#2ecc71;
font-weight:bold;
text-decoration:none;
}

.donation a:hover,
.upute a:hover,
.whatsapp-link a:hover{
text-decoration:underline;
}

.upute{
margin-top:5px;
font-size:13px;
text-align:left;
max-width:420px;
line-height:1.5;
}

.napomene{
margin-top:12px;
font-size:12px;
text-align:left;
max-width:420px;
line-height:1.6;
opacity:0.9;
}

.napomene div{
display:block;
margin-bottom:4px;
}

.whatsapp-link{
margin-top:15px;
font-size:14px;
}

.etapa-progress{
display:flex;
gap:5px;
justify-content:center;
flex-wrap:wrap;
max-width:420px;
margin:10px auto 15px auto;
}

.etapa-rect{
height:18px;
border-radius:3px;
background:transparent;
border:2px solid white;
flex:1;
min-width:12px;
max-width:40px;
transition:background 0.4s, border-color 0.4s;
}

.etapa-rect.done{
background:#2ecc71;
border-color:#2ecc71;
}

.etapa-rect.done-warning{
background:#f1c40f;
border-color:#f1c40f;
}

.etapa-rect.done-danger{
background:#e74c3c;
border-color:#e74c3c;
}

</style>
</head>

<body>

<div style="display:inline-block;text-align:left;padding:0 16px;position:relative;">
<h1 id="mainTitle" style="margin-top:20px;margin-bottom:2px;text-align:left;">
KARDIO TRENING 
<span class="version">
v3.22
<a href="https://youtu.be/5qAVh30ElvM?si=59BPaG-FaY_l5Otk" target="_blank"></a>
</span>
</h1>
<div class="author" style="position:relative;">
<span id="qrBtn" style="cursor:pointer;color:#f1c40f;font-size:12px;text-decoration:none;" onclick="showQR()">QR kod</span>
<span id="authorLabel" style="cursor:pointer;position:absolute;" onclick="authorClick()">by Branke</span>
</div>
</div>

<script>
window.addEventListener('DOMContentLoaded',function(){
  alignAuthor();
});
window.addEventListener('resize',alignAuthor);
function alignAuthor(){
  var h1=document.getElementById('mainTitle');
  var lbl=document.getElementById('authorLabel');
  // Mjerimo širinu teksta "KARDIO TRENING " bez version spana
  var canvas=document.createElement('canvas');
  var ctx=canvas.getContext('2d');
  var style=window.getComputedStyle(h1);
  ctx.font=style.fontWeight+' '+style.fontSize+' '+style.fontFamily;
  var textWidth=ctx.measureText('KARDIO TRENING').width;
  // Pozicioniramo desni rub "by Branke" na textWidth
  lbl.style.left=(textWidth - lbl.offsetWidth)+'px';
  lbl.style.top='0';
}
</script>

<div class="container">

<div id="etapeSelection">

<!-- QR kod prikaz -->
<div id="qrView" class="hidden" style="padding:20px 10px;">
<div id="qrContainer" style="display:inline-block;border:8px solid white;border-radius:8px;line-height:0;"></div>
<div style="margin-top:16px;font-size:15px;font-style:italic;color:white;">
"Tko se s nama druži, život mu je duži!"
</div>
<div style="margin-top:14px;">
<button class="green-btn" onclick="hideQR()">POVRATAK</button>
</div>
</div>

<!-- Odabir etapa -->
<div id="selectionView">

<div class="upute">

<strong>Upute:</strong><br>

Dnevni kardio trening se sastoji od:<br>

1. Jutarnje tjelovježbe 
(<a href="https://youtu.be/EkyuoWBDIo0?si=M5GQf5lPK3YvOvsk" target="_blank">
YouTube link
</a>) - 30min<br>

2. Prijepodnevna vožnja sobnog bicikla<br>

3. Popodnevna vožnja sobnog bicikla<br>

</div>

<div style="margin-top:15px;margin-bottom:10px;font-size:18px;">
Odaberi broj etapa vožnje sobnog bicikla:
</div>

<div class="etape-buttons">

<div>
<button onclick="selectEtape(3)">3</button>
<button onclick="selectEtape(4)">4</button>
<button onclick="selectEtape(5)">5</button>
<button onclick="selectEtape(6)">6</button>
<button onclick="selectEtape(7)">7</button>
</div>

<div>
<button onclick="selectEtape(8)">8</button>
<button onclick="selectEtape(9)">9</button>
<button onclick="selectEtape(10)">10</button>
<button onclick="selectEtape(11)">11</button>
<button onclick="selectEtape(12)">12</button>
</div>

</div>

<div class="napomene">
<div>* Prije početka vježbanja savjetujte se s liječnikom.</div>
<div>** Vježbe započnite lagano i postupno pojačavajte.</div>
<div>*** Sobni bicikl: krenite sa srednjim opterećenjem, krenite s 4 etape i povećavajte dnevno do 12 max. (držite tempo oko 60 okr/min (15km/h)).</div>
</div>

<div style="margin-top:15px;font-size:14px;">
Program napravljen za poboljšanje općeg kardio stanja.
</div>

<div style="font-size:12px;margin-top:10px;">
Program nastao tijekom kardio rehabilitacije (veljača 2026)
</div>

<div class="donation">
Program je potpuno besplatan, a znak zahvalnosti možete uplatiti na 
<a href="https://revolut.me/brankebananke" target="_blank">
Revolut
</a>
račun.
</div>

<div class="whatsapp-link">
<a href="https://wa.me/385994626921" target="_blank">
Branke@Whatsapp kontakt
</a>
</div>

</div>

<div id="trainingArea" class="hidden">

<div id="phaseLabel" class="phase-label">PRIPREMA</div>

<div class="total-time">Vrijeme treniranja: <span id="totalTime">00:00</span></div>

<div class="circles">
<div class="circle exercise" id="c1"><div class="fill" id="f1"></div></div>
<div class="circle exercise" id="c2"><div class="fill" id="f2"></div></div>
<div class="circle rest" id="c3"><div class="fill" id="f3"></div></div>
</div>

<div class="remaining-time">
Preostalo vrijeme: <span id="remainingTime">00:00</span>
</div>

<div class="info">
Etapa <span id="currentEtapa">1</span> / <span id="totalEtapaDisplay">0</span>
</div>

<div class="etapa-progress" id="etapaProgress"></div>

<button id="repeatBtn" class="white-btn hidden" onclick="resetProgram()">
PONOVI VJEŽBANJE
</button>

<div id="startButtons">
<button id="startStopBtn" class="main-btn hidden" onclick="toggleTraining()">
START
</button>
<button id="prekidBtn" class="red-btn hidden" onclick="resetProgram()">
PREKID
</button>
</div>

<div id="pauseOptions" class="hidden">
<button class="green-btn" onclick="resumeTraining()">NASTAVI</button>
<button class="red-btn" onclick="resetProgram()">PREKID</button>
</div>

</div>

</div>

<script>

let totalEtape=0;
let currentEtapa=1;
let phase=0;
let seconds=0;
let totalSeconds=0;
let totalPlannedSeconds=0;
let cooldownEndSeconds=0;
let interval=null;
let running=false;
let audioCtx=null;
let inCooldown=false;
let cooldownMinute=0;
let wakeLock=null;
let phaseDuration=60; /* testni mod: 10s, normalni: 60s */
let testMode=false;
let authorYellow=false;

function authorClick(){
/* Samo na ekranu odabira etapa */
if(!document.getElementById("etapeSelection").classList.contains("hidden")){
authorYellow=!authorYellow;
const lbl=document.getElementById("authorLabel");
if(authorYellow){
lbl.style.color="#f1c40f";
/* Aktiviraj testni mod (10s) */
testMode=true;
phaseDuration=5;
lbl.title="TEST MOD: 5s/faza";
}else{
lbl.style.color="red";
/* Vrati normalni mod (60s) */
testMode=false;
phaseDuration=60;
lbl.title="";
}
}
}

function showQR(){
document.getElementById("selectionView").classList.add("hidden");
document.getElementById("qrView").classList.remove("hidden");
generateQR("https://brankecoder.github.io/branke-kardio-trening/Kardio_by_Branke.html");
}

function hideQR(){
document.getElementById("qrView").classList.add("hidden");
document.getElementById("selectionView").classList.remove("hidden");
}

/* QR code generator pomoću QRious biblioteke */
function generateQR(url){
const container=document.getElementById("qrContainer");
container.innerHTML="";
function doGenerate(){
const canvas=document.createElement("canvas");
container.appendChild(canvas);
new QRious({
element:canvas,
value:url,
size:220,
backgroundAlpha:1,
background:"#ffffff",
foreground:"#000000",
level:"H"
});
}
if(typeof QRious!=="undefined"){
doGenerate();
}else{
const script=document.createElement("script");
script.src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js";
script.onload=doGenerate;
document.head.appendChild(script);
}
}

async function requestWakeLock(){
try{
if('wakeLock' in navigator){
wakeLock=await navigator.wakeLock.request('screen');
}
}catch(err){}
}

document.addEventListener("visibilitychange",()=>{
if(wakeLock!==null && document.visibilityState==="visible"){
requestWakeLock();
}
});

function buildEtapaProgress(){
const container=document.getElementById("etapaProgress");
container.innerHTML="";
for(let i=1;i<=totalEtape;i++){
const rect=document.createElement("div");
rect.className="etapa-rect";
rect.id="eRect"+i;
container.appendChild(rect);
}
}

/* Bojanje pravokutnika napretka.
   Boji sve etape do currentEtapa uključivo (odmah na početku etape).
   Poziv s finalCall=true boji i zadnju etapu crvenom (za kraj treninga). */
function updateEtapaProgress(finalCall){
let upTo = finalCall ? currentEtapa : currentEtapa;
for(let i=1;i<=upTo;i++){
const rect=document.getElementById("eRect"+i);
if(rect){
rect.className="etapa-rect";
if(i===totalEtape) rect.classList.add("done-danger");
else if(i===totalEtape-1) rect.classList.add("done-warning");
else rect.classList.add("done");
}
}
}

function selectEtape(num){
totalEtape=num;
totalPlannedSeconds=(num*3-1)*phaseDuration;
document.getElementById("remainingTime").innerText=formatTime(totalPlannedSeconds);
document.getElementById("totalEtapaDisplay").innerText=num;
document.getElementById("etapeSelection").classList.add("hidden");
document.getElementById("trainingArea").classList.remove("hidden");
document.getElementById("startStopBtn").classList.remove("hidden");
document.getElementById("prekidBtn").classList.remove("hidden");
buildEtapaProgress();
}

function updateCirclesForEtapa(){
const c3=document.getElementById("c3");
if(currentEtapa>=totalEtape){
c3.classList.add("hidden");
}else{
c3.classList.remove("hidden");
}
}

function playBeep(type){
if(!audioCtx){
audioCtx=new (window.AudioContext||window.webkitAudioContext)();
}
if(audioCtx.state==='suspended'){
audioCtx.resume();
}
if(type==='pulse'){
/* Pulsrajuci beep - za crveni krug (odmor): 4 kratka pulsa */
[0,0.35,0.70,1.05].forEach(function(offset){
const osc=audioCtx.createOscillator();
const g=audioCtx.createGain();
osc.connect(g);
g.connect(audioCtx.destination);
osc.type='square';
osc.frequency.value=880;
const t=audioCtx.currentTime+offset;
g.gain.setValueAtTime(0.0,t);
g.gain.linearRampToValueAtTime(0.8,t+0.02);
g.gain.setValueAtTime(0.8,t+0.18);
g.gain.linearRampToValueAtTime(0.0,t+0.25);
osc.start(t);
osc.stop(t+0.26);
});
}else{
/* Dugi beep - za zelene i plave krugove */
const osc=audioCtx.createOscillator();
const g=audioCtx.createGain();
osc.connect(g);
g.connect(audioCtx.destination);
osc.type='square';
osc.frequency.value=660;
const t=audioCtx.currentTime;
g.gain.setValueAtTime(0.0,t);
g.gain.linearRampToValueAtTime(0.8,t+0.02);
g.gain.setValueAtTime(0.8,t+1.2);
g.gain.linearRampToValueAtTime(0.0,t+1.5);
osc.start(t);
osc.stop(t+1.51);
}
}

function updateLabel(text,color){
const lbl=document.getElementById("phaseLabel");
lbl.innerText=text;
lbl.style.color=color;
}

function updateRemaining(){
let remaining;
if(inCooldown){
remaining=cooldownEndSeconds-totalSeconds;
}else{
remaining=totalPlannedSeconds-totalSeconds;
}
if(remaining<0) remaining=0;
document.getElementById("remainingTime").innerText=formatTime(remaining);
}

/* Resetira visinu fill elementa bez CSS tranzicije, pa je vrati */
function resetFill(id){
const el=document.getElementById(id);
el.style.transition="none";
el.style.height="0%";
/* Forsirani reflow da browser "vidi" promjenu prije vraćanja tranzicije */
el.getBoundingClientRect();
el.style.transition="height 1s linear";
}

function tick(){
seconds++;
totalSeconds++;
console.log("tick: seconds="+seconds+" phaseDuration="+phaseDuration+" phase="+phase+" inCooldown="+inCooldown);
updateRemaining();
document.getElementById("totalTime").innerText=formatTime(totalSeconds);

let maxPhase=(currentEtapa>=totalEtape)?1:2;

document.getElementById("f"+(phase+1)).style.height=((seconds/phaseDuration)*100)+"%";

if(seconds>=phaseDuration){
let filledPhase=phase;
let beepType=(filledPhase===2)?'pulse':'long';
console.log("ZVUK tick: filledPhase="+filledPhase+" beepType="+beepType+" etapa="+currentEtapa+"/"+totalEtape+" maxPhase="+maxPhase);
playBeep(beepType);
document.getElementById("f"+(filledPhase+1)).style.height="100%";
seconds=0;
phase++;

if(phase>maxPhase){
phase=0;
resetFill("f1");
resetFill("f2");
resetFill("f3");
if(currentEtapa>=totalEtape){
startCooldown();
return;
}
currentEtapa++;
document.getElementById("currentEtapa").innerText=currentEtapa;
updateEtapaProgress();
updateCirclesForEtapa();
}

if(!inCooldown){
if(phase===0||phase===1){
updateLabel("VJEŽBAJ!","#2ecc71");
}else{
updateLabel("ODMARAJ!","#e74c3c");
}
}
}
}

function startCooldown(){
inCooldown=true;
cooldownMinute=0;
seconds=0;
cooldownEndSeconds=totalSeconds+(phaseDuration*3);
updateRemaining();
updateLabel("OPUŠTANJE","#3498db");
updateEtapaProgress(true);
const c3=document.getElementById("c3");
c3.classList.remove("hidden");
document.getElementById("c1").className="circle cooldown";
document.getElementById("c2").className="circle cooldown";
document.getElementById("c3").className="circle cooldown";
}

function cooldownTick(){
seconds++;
totalSeconds++;
updateRemaining();
document.getElementById("totalTime").innerText=formatTime(totalSeconds);
let percent=(seconds/phaseDuration)*100;
document.getElementById("f"+(cooldownMinute+1)).style.height=percent+"%";

if(seconds>=phaseDuration){
console.log("ZVUK cooldown: cooldownMinute="+cooldownMinute);
playBeep('long');
document.getElementById("f"+(cooldownMinute+1)).style.height="100%";
seconds=0;
cooldownMinute++;

if(cooldownMinute>=3){
clearInterval(interval);
updateLabel("Bravo trening završen!","#2ecc71");
document.getElementById("startStopBtn").classList.add("hidden");
document.getElementById("prekidBtn").classList.add("hidden");
document.getElementById("repeatBtn").classList.remove("hidden");
return;
}
resetFill("f"+(cooldownMinute+1));
}
}

function mainLoop(){
if(inCooldown){
cooldownTick();
}else{
tick();
}
}

function toggleTraining(){
if(!running){
/* Kreiraj AudioContext odmah iz korisnicke interakcije (klik) */
if(!audioCtx){
audioCtx=new (window.AudioContext||window.webkitAudioContext)();
}
if(audioCtx.state==='suspended'){
audioCtx.resume();
}
running=true;
requestWakeLock();
document.getElementById("startStopBtn").innerText="ZAUSTAVI";
document.getElementById("startStopBtn").className="stop-btn";
document.getElementById("prekidBtn").classList.add("hidden");
updateLabel("VJEŽBAJ!","#2ecc71");
updateCirclesForEtapa();
updateEtapaProgress();
interval=setInterval(mainLoop,1000);
}else{
pauseTraining();
}
}

function pauseTraining(){
running=false;
clearInterval(interval);
document.getElementById("startStopBtn").classList.add("hidden");
document.getElementById("pauseOptions").classList.remove("hidden");
}

function resumeTraining(){
running=true;
requestWakeLock();
document.getElementById("pauseOptions").classList.add("hidden");
document.getElementById("startStopBtn").classList.remove("hidden");
document.getElementById("prekidBtn").classList.add("hidden");
document.getElementById("startStopBtn").innerText="ZAUSTAVI";
document.getElementById("startStopBtn").className="stop-btn";
interval=setInterval(mainLoop,1000);
}

function resetProgram(){
location.reload();
}

function formatTime(sec){
let m=Math.floor(sec/60);
let s=sec%60;
return String(m).padStart(2,'0')+":"+String(s).padStart(2,'0');
}

</script>

</body>
</html>
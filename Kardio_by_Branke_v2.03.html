<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kardio Trening</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#111;
    color:white;
    text-align:center;
}

h1{
    margin-top:20px;
    margin-bottom:2px;
}

.author{
    font-size:12px;
    color:red;
    margin-bottom:15px;
}

.container{
    display:flex;
    flex-direction:column;
    align-items:center;
    padding-top:10px;
}

button{
    padding:10px 18px;
    margin:3px;
    font-size:16px;
    border-radius:4px;
    border:none;
    cursor:pointer;
}

.etape-buttons button{
    background:#444;
    color:white;
    width:60px;
}

.main-btn{
    background:#2ecc71;
    color:black;
    font-weight:bold;
}

.stop-btn{
    background:#e74c3c;
    color:white;
    font-weight:bold;
}

.green-btn{
    background:#2ecc71;
    color:black;
    font-weight:bold;
}

.red-btn{
    background:#e74c3c;
    color:white;
    font-weight:bold;
}

.white-btn{
    background:white;
    color:black;
    font-weight:bold;
}

.hidden{display:none;}

.phase-label{
    font-size:24px;
    font-weight:bold;
    margin:10px 0 5px 0;
}

.total-time{
    margin-bottom:5px;
}

.remaining-time{
    margin-top:10px;
    margin-bottom:5px;
    font-size:18px;
}

.circles{
    display:flex;
    gap:15px;
    margin:10px 0;
}

.circle{
    width:75px;
    height:75px;
    border-radius:50%;
    position:relative;
    overflow:hidden;
}

.exercise{background:#2ecc71;}
.rest{background:#e74c3c;}
.cooldown{background:#3498db;}

.fill{
    position:absolute;
    bottom:0;
    width:100%;
    height:0%;
    background:rgba(0,0,0,0.35);
    transition:height 1s linear;
}

.info{
    font-size:18px;
    margin:10px;
}
</style>
</head>

<body>

<h1>KARDIO TRENING</h1>
<div class="author">by Branke</div>

<div class="container">

<div id="etapeSelection">

    <div class="etape-buttons">
        <div>
            <button onclick="selectEtape(3)">3</button>
            <button onclick="selectEtape(4)">4</button>
            <button onclick="selectEtape(5)">5</button>
            <button onclick="selectEtape(6)">6</button>
            <button onclick="selectEtape(7)">7</button>
        </div>
        <div>
            <button onclick="selectEtape(8)">8</button>
            <button onclick="selectEtape(9)">9</button>
            <button onclick="selectEtape(10)">10</button>
            <button onclick="selectEtape(11)">11</button>
            <button onclick="selectEtape(12)">12</button>
        </div>
    </div>

    <div style="margin-top:20px; font-size:18px;">
        Odaberi broj etapa vožnje sobnog bicikla.
    </div>

    <div style="margin-top:15px; font-size:14px;">
        Program napravljen po uzoru na kardio vježbe u SBKT.
    </div>

    <div style="font-size:12px; margin-top:5px;">
        Odobrili i testirali Vinko Bandić i Branko Pintarić! (veljača 2026)
    </div>

</div>

<div id="trainingArea" class="hidden">

    <div id="phaseLabel" class="phase-label">PRIPREMA</div>

    <div class="total-time">
        Vrijeme treniranja: <span id="totalTime">00:00</span>
    </div>

    <div class="circles">
        <div class="circle exercise" id="c1"><div class="fill" id="f1"></div></div>
        <div class="circle exercise" id="c2"><div class="fill" id="f2"></div></div>
        <div class="circle rest" id="c3"><div class="fill" id="f3"></div></div>
    </div>

    <div class="remaining-time">
        Preostalo vrijeme: <span id="remainingTime">00:00</span>
    </div>

    <div class="info">
        Etapa <span id="currentEtapa">1</span> /
        <span id="totalEtapaDisplay">0</span>
    </div>

    <button id="repeatBtn" class="white-btn hidden" onclick="resetProgram()">PONOVI VJEŽBANJE</button>

    <button id="startStopBtn" class="main-btn hidden" onclick="toggleTraining()">START</button>

    <div id="pauseOptions" class="hidden">
        <button class="green-btn" onclick="resumeTraining()">NASTAVI</button>
        <button class="red-btn" onclick="resetProgram()">PREKINI</button>
    </div>

</div>

</div>

<script>
let totalEtape=0;
let currentEtapa=1;
let phase=0;
let seconds=0;
let totalSeconds=0;
let totalPlannedSeconds=0;
let interval=null;
let running=false;
let audioCtx=null;
let inCooldown=false;
let cooldownMinute=0;
let wakeLock=null;

async function requestWakeLock(){
    try{
        if('wakeLock' in navigator){
            wakeLock=await navigator.wakeLock.request('screen');
        }
    }catch(err){}
}

document.addEventListener("visibilitychange",()=>{
    if(wakeLock!==null && document.visibilityState==="visible"){
        requestWakeLock();
    }
});

function selectEtape(num){
    totalEtape=num;
    totalPlannedSeconds=(num*3+3)*60;
    document.getElementById("remainingTime").innerText=formatTime(totalPlannedSeconds);
    document.getElementById("totalEtapaDisplay").innerText=num;
    document.getElementById("etapeSelection").classList.add("hidden");
    document.getElementById("trainingArea").classList.remove("hidden");
    document.getElementById("startStopBtn").classList.remove("hidden");
}

function playBeep(){
    if(!audioCtx){
        audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    }
    const osc=audioCtx.createOscillator();
    const gain=audioCtx.createGain();
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.frequency.value=1000;
    gain.gain.setValueAtTime(0.3,audioCtx.currentTime);
    osc.start();
    osc.stop(audioCtx.currentTime+0.25);
}

function updateLabel(text,color){
    const lbl=document.getElementById("phaseLabel");
    lbl.innerText=text;
    lbl.style.color=color;
}

function updateRemaining(){
    let remaining=totalPlannedSeconds-totalSeconds;
    if(remaining<0) remaining=0;
    document.getElementById("remainingTime").innerText=formatTime(remaining);
}

function tick(){
    seconds++;
    totalSeconds++;
    updateRemaining();
    document.getElementById("totalTime").innerText=formatTime(totalSeconds);

    let percent=(seconds/60)*100;
    document.getElementById("f"+(phase+1)).style.height=percent+"%";

    if(seconds>=60){
        playBeep();
        document.getElementById("f"+(phase+1)).style.height="100%";
        seconds=0;
        phase++;

        if(phase>2){
            phase=0;
            clearCircles();

            if(currentEtapa>=totalEtape){
                startCooldown();
                return;
            }

            currentEtapa++;
            document.getElementById("currentEtapa").innerText=currentEtapa;
        }

        if(!inCooldown){
            if(phase===0||phase===1){
                updateLabel("VJEŽBAJ!","#2ecc71");
            }else{
                updateLabel("ODMARAJ!","#e74c3c");
            }
        }
    }
}

function clearCircles(){
    document.getElementById("f1").style.height="0%";
    document.getElementById("f2").style.height="0%";
    document.getElementById("f3").style.height="0%";
}

function startCooldown(){
    inCooldown=true;
    cooldownMinute=0;
    seconds=0;
    updateLabel("OPUŠTANJE","#3498db");
    document.getElementById("c1").className="circle cooldown";
    document.getElementById("c2").className="circle cooldown";
    document.getElementById("c3").className="circle cooldown";
}

function cooldownTick(){
    seconds++;
    totalSeconds++;
    updateRemaining();
    document.getElementById("totalTime").innerText=formatTime(totalSeconds);

    let percent=(seconds/60)*100;
    document.getElementById("f"+(cooldownMinute+1)).style.height=percent+"%";

    if(seconds>=60){
        playBeep();
        document.getElementById("f"+(cooldownMinute+1)).style.height="100%";
        seconds=0;
        cooldownMinute++;

        if(cooldownMinute>2){
            clearInterval(interval);
            updateLabel("Bravo trening završen!","#2ecc71");
            document.getElementById("startStopBtn").classList.add("hidden");
            document.getElementById("repeatBtn").classList.remove("hidden");
        }
    }
}

function mainLoop(){
    if(inCooldown){cooldownTick();}
    else{tick();}
}

function toggleTraining(){
    if(!running){
        running=true;
        requestWakeLock();
        document.getElementById("startStopBtn").innerText="ZAUSTAVI";
        document.getElementById("startStopBtn").className="stop-btn";
        updateLabel("VJEŽBAJ!","#2ecc71");
        interval=setInterval(mainLoop,1000);
    }else{
        pauseTraining();
    }
}

function pauseTraining(){
    running=false;
    clearInterval(interval);
    document.getElementById("startStopBtn").classList.add("hidden");
    document.getElementById("pauseOptions").classList.remove("hidden");
}

function resumeTraining(){
    running=true;
    requestWakeLock();
    document.getElementById("pauseOptions").classList.add("hidden");
    document.getElementById("startStopBtn").classList.remove("hidden");
    document.getElementById("startStopBtn").innerText="ZAUSTAVI";
    document.getElementById("startStopBtn").className="stop-btn";
    interval=setInterval(mainLoop,1000);
}

function resetProgram(){
    location.reload();
}

function formatTime(sec){
    let m=Math.floor(sec/60);
    let s=sec%60;
    return String(m).padStart(2,'0')+":"+String(s).padStart(2,'0');
}
</script>

</body>
</html>